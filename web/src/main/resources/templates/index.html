<!DOCTYPE html>
<html ng-app="app" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link th:href="@{/webjars/bootstrap/3.3.5/css/bootstrap.min.css}" rel="stylesheet" media="screen"/>

    <link th:href="@{/css/ind.css}" rel="stylesheet"/>
    <link th:href="@{/css/common.css}" rel="stylesheet"/>

    <link th:href="@{/css/navbar.css}" rel="stylesheet"/>
    <link rel="stylesheet" media="screen" th:href="@{/fonts/font-awesome/font-awesome.min.css}"/>
    <link rel="stylesheet" media="screen" th:href="@{/css/bootstrap-dialog.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/semantic/dist/semantic.min.css}"/>


    <title>Online shop</title>
</head>
<body>
<div id="nav"></div>

<header id="about">
    <div class="container">
        <div class="intro-text">
            <div class="intro-lead-in">Test application</div>
            <div class="intro-heading">Developed by Tomasz Zielichowski</div>
        </div>
    </div>
</header>

<div class="container">

    <div class="row">
        <section class="content" id="shop">

            <div ng-controller="Products" id="productsTableBody">
                <div class="col-md-9 col-lg-9 ">
                    <div ng-repeat="product in products" update-checkbox-directive>
                        <div class="clearfix" ng-show="$index % 3 == 0"></div>

                        <div class="col-sm-4 col-lg-4 col-md-4">
                            <div class="thumbnail simpleCart_shelfItem">
                                <img class="img-responsive item_image"
                                     ng-src="data:image/JPEG;base64,{{product.image}}">
                                <div class="caption">
                                    <h4 class="item_name">{{product.description}}</h4>
                                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor
                                        incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis
                                        nostrud
                                        exercitation ullamco laboris nisi ut aliquip </p>
                                    <h4 class="pull-right item_price"><strong>{{product.price.denomination}}
                                        {{product.price.currencyCode}}</strong></h4>
                                </div>

                                <div class="item_id hidden">{{product.id}}</div>

                                <a class="item_add" href="javascript:;"> Add to Cart </a>

                            </div>
                        </div>
                    </div>
                    <div sec:authorize="hasRole('ROLE_ADMIN')">
                        <button class="ui secondary basic button" type="button" id="add-product">Dodaj nowy produkt
                        </button>
                    </div>
                </div>
            </div>

            <div id="basket" class="col-xs-12 col-sm-12 col-md-3 col-lg-3">
                <div class="simpleCart_items"></div>

                <div class="panel panel-green">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-xs-3">
                                <i class="fa fa-shopping-cart fa-4x"></i>
                            </div>
                            <div class="col-xs-9 text-right">
                                <div class="simpleCart_total">Current total price !</div>
                            </div>
                        </div>

                    </div>
                    <div class="panel-footer">
                        <button type="submit" class="simpleCart_checkout btn btn-info pull-right♠">Place order ! <i
                                class="fa fa-arrow-circle-right"></i></button>
                        <div class="clearfix"></div>
                        <a href="javascript:;" class=" btn btn-info simpleCart_empty">Clear shopping cart </a>

                    </div>
                </div>
            </div>
        </section>
    </div>

    <div class="ui modal" id="modal-product">
        <form class="ui form" th:action="@{/products}" method="post" enctype="multipart/form-data">
            <h4 class="ui dividing header">New produkt</h4>
            <div class="field">
                <label>Name</label>
                <input type="text" name="description" placeholder="Name">
            </div>
            <div class="field">
                <label>Image</label>
                <input name="image" type="file" class="" id="imgInp">
                <img id="blah" src="#" alt="your image" height="300" />

            </div>

            <div class="field">
                <label>Price</label>
                <input type="number" name="price" placeholder="Price">
            </div>
            <div class="field">
                <span>Currency</span>
                <div class="ui selection dropdown" id="currencies">
                    <input type="hidden" name="currency">
                    <i class="dropdown icon"></i>
                    <div class="default text">Select</div>
                    <div class="menu" name="store-add-currency">
                        <div class="item" data-value="ALL">Albania Lek (Lek)</div>
                        <div class="item" data-value="AFN">Afghanistan Afghani (؋)</div>
                        <div class="item" data-value="ARS">Argentina Peso ($)</div>
                        <div class="item" data-value="AWG">Aruba Guilder (ƒ)</div>
                        <div class="item" data-value="AUD">Australia Dollar ($)</div>
                        <div class="item" data-value="AZN">Azerbaijan New Manat (ман)</div>
                        <div class="item" data-value="BSD">Bahamas Dollar ($)</div>
                        <div class="item" data-value="BBD">Barbados Dollar ($)</div>
                        <div class="item" data-value="BYR">Belarus Ruble (p.)</div>
                        <div class="item" data-value="BZD">Belize Dollar (BZ$)</div>
                        <div class="item" data-value="BMD">Bermuda Dollar ($)</div>
                        <div class="item" data-value="BOB">Bolivia Boliviano ($b)</div>
                        <div class="item" data-value="BAM">Bosnia and Herzegovina Convertible Marka (KM)</div>
                        <div class="item" data-value="BWP">Botswana Pula (P)</div>
                        <div class="item" data-value="BGN">Bulgaria Lev (лв)</div>
                        <div class="item" data-value="BGL">Bulgaria Lev (лв)</div>
                        <div class="item" data-value="BRL">Brazil Real (R$)</div>
                        <div class="item" data-value="BND">Brunei Darussalam Dollar ($)</div>
                        <div class="item" data-value="KHR">Cambodia Riel (៛)</div>
                        <div class="item" data-value="CAD">Canada Dollar ($)</div>
                        <div class="item" data-value="KYD">Cayman Islands Dollar ($)</div>
                        <div class="item" data-value="CLP">Chile Peso ($)</div>
                        <div class="item" data-value="CNY">China Yuan Renminbi (¥)</div>
                        <div class="item" data-value="COP">Colombia Peso ($)</div>
                        <div class="item" data-value="CRC">Costa Rica Colon (₡)</div>
                        <div class="item" data-value="HRK">Croatia Kuna (kn)</div>
                        <div class="item" data-value="CUP">Cuba Peso (₱)</div>
                        <div class="item" data-value="CZK">Czech Republic Koruna (Kč)</div>
                        <div class="item" data-value="DKK">Denmark Krone (kr)</div>
                        <div class="item" data-value="DOP">Dominican Republic Peso (RD$)</div>
                        <div class="item" data-value="XCD">East Caribbean Dollar ($)</div>
                        <div class="item" data-value="EGP">Egypt Pound (£)</div>
                        <div class="item" data-value="SVC">El Salvador Colon ($)</div>
                        <div class="item" data-value="EEK">Estonia Kroon (kr)</div>
                        <div class="item" data-value="EUR">Euro Member Countries (€)</div>
                        <div class="item" data-value="FKP">Falkland Islands (Malvinas) Pound (£)</div>
                        <div class="item" data-value="FJD">Fiji Dollar ($)</div>
                        <div class="item" data-value="GHC">Ghana Cedis (¢)</div>
                        <div class="item" data-value="GIP">Gibraltar Pound (£)</div>
                        <div class="item" data-value="GTQ">Guatemala Quetzal (Q)</div>
                        <div class="item" data-value="GGP">Guernsey Pound (£)</div>
                        <div class="item" data-value="GYD">Guyana Dollar ($)</div>
                        <div class="item" data-value="HNL">Honduras Lempira (L)</div>
                        <div class="item" data-value="HKD">Hong Kong Dollar ($)</div>
                        <div class="item" data-value="HUF">Hungary Forint (Ft)</div>
                        <div class="item" data-value="ISK">Iceland Krona (kr)</div>
                        <div class="item" data-value="INR" selected="selected">Indian Rupee (₹)</div>
                        <div class="item" data-value="IDR">Indonesia Rupiah (Rp)</div>
                        <div class="item" data-value="IRR">Iran Rial (﷼)</div>
                        <div class="item" data-value="IMP">Isle of Man Pound (£)</div>
                        <div class="item" data-value="ILS">Israel Shekel (₪)</div>
                        <div class="item" data-value="JMD">Jamaica Dollar (J$)</div>
                        <div class="item" data-value="JPY">Japan Yen (¥)</div>
                        <div class="item" data-value="JEP">Jersey Pound (£)</div>
                        <div class="item" data-value="KZT">Kazakhstan Tenge (лв)</div>
                        <div class="item" data-value="KPW">Korea (North) Won (₩)</div>
                        <div class="item" data-value="KRW">Korea (South) Won (₩)</div>
                        <div class="item" data-value="KGS">Kyrgyzstan Som (лв)</div>
                        <div class="item" data-value="LAK">Laos Kip (₭)</div>
                        <div class="item" data-value="LVL">Latvia Lat (Ls)</div>
                        <div class="item" data-value="LBP">Lebanon Pound (£)</div>
                        <div class="item" data-value="LRD">Liberia Dollar ($)</div>
                        <div class="item" data-value="LTL">Lithuania Litas (Lt)</div>
                        <div class="item" data-value="MKD">Macedonia Denar (ден)</div>
                        <div class="item" data-value="MYR">Malaysia Ringgit (RM)</div>
                        <div class="item" data-value="MUR">Mauritius Rupee (₨)</div>
                        <div class="item" data-value="MXN">Mexico Peso ($)</div>
                        <div class="item" data-value="MNT">Mongolia Tughrik (₮)</div>
                        <div class="item" data-value="MZN">Mozambique Metical (MT)</div>
                        <div class="item" data-value="NAD">Namibia Dollar ($)</div>
                        <div class="item" data-value="NPR">Nepal Rupee (₨)</div>
                        <div class="item" data-value="ANG">Netherlands Antilles Guilder (ƒ)</div>
                        <div class="item" data-value="NZD">New Zealand Dollar ($)</div>
                        <div class="item" data-value="NIO">Nicaragua Cordoba (C$)</div>
                        <div class="item" data-value="NGN">Nigeria Naira (₦)</div>
                        <div class="item" data-value="NOK">Norway Krone (kr)</div>
                        <div class="item" data-value="OMR">Oman Rial (﷼)</div>
                        <div class="item" data-value="PKR">Pakistan Rupee (₨)</div>
                        <div class="item" data-value="PAB">Panama Balboa (B/.)</div>
                        <div class="item" data-value="PYG">Paraguay Guarani (Gs)</div>
                        <div class="item" data-value="PEN">Peru Nuevo Sol (S/.)</div>
                        <div class="item" data-value="PHP">Philippines Peso (₱)</div>
                        <div class="item" data-value="PLN">Poland Zloty (zł)</div>
                        <div class="item" data-value="QAR">Qatar Riyal (﷼)</div>
                        <div class="item" data-value="RON">Romania New Leu (lei)</div>
                        <div class="item" data-value="RUB">Russia Ruble (руб)</div>
                        <div class="item" data-value="SHP">Saint Helena Pound (£)</div>
                        <div class="item" data-value="SAR">Saudi Arabia Riyal (﷼)</div>
                        <div class="item" data-value="RSD">Serbia Dinar (Дин.)</div>
                        <div class="item" data-value="SCR">Seychelles Rupee (₨)</div>
                        <div class="item" data-value="SGD">Singapore Dollar ($)</div>
                        <div class="item" data-value="SBD">Solomon Islands Dollar ($)</div>
                        <div class="item" data-value="SOS">Somalia Shilling (S)</div>
                        <div class="item" data-value="ZAR">South Africa Rand (R)</div>
                        <div class="item" data-value="LKR">Sri Lanka Rupee (₨)</div>
                        <div class="item" data-value="SEK">Sweden Krona (kr)</div>
                        <div class="item" data-value="CHF">Switzerland Franc (CHF)</div>
                        <div class="item" data-value="SRD">Suriname Dollar ($)</div>
                        <div class="item" data-value="SYP">Syria Pound (£)</div>
                        <div class="item" data-value="TWD">Taiwan New Dollar (NT$)</div>
                        <div class="item" data-value="THB">Thailand Baht (฿)</div>
                        <div class="item" data-value="TTD">Trinidad and Tobago Dollar (TT$)</div>
                        <div class="item" data-value="TRY">Turkey Lira (TL)</div>
                        <div class="item" data-value="TRL">Turkey Lira (₤)</div>
                        <div class="item" data-value="TVD">Tuvalu Dollar ($)</div>
                        <div class="item" data-value="UAH">Ukraine Hryvna (₴)</div>
                        <div class="item" data-value="GBP">United Kingdom Pound (£)</div>
                        <div class="item" data-value="USD">United States Dollar ($)</div>
                        <div class="item" data-value="UYU">Uruguay Peso ($U)</div>
                        <div class="item" data-value="UZS">Uzbekistan Som (лв)</div>
                        <div class="item" data-value="VEF">Venezuela Bolivar Fuerte (Bs)</div>
                        <div class="item" data-value="VND">Viet Nam Dong (₫)</div>
                        <div class="item" data-value="YER">Yemen Rial (﷼)</div>
                        <div class="item" data-value="ZWD">Zimbabwe Dollar (Z$)</div>
                    </div>
                </div>
            </div>
            <button type="submit" class="button">submit</button>
        </form>

    </div>

</div>
<!-- start contact -->
<section id="contact">

</section>
<!-- end contact -->

<script th:src="@{/webjars/angularjs/1.0.8/angular.min.js}"></script>
<script th:src="@{/webjars/jquery/2.1.4/jquery.min.js}" type="text/javascript"></script>
<script th:src="@{/webjars/bootstrap/3.3.5/js/bootstrap.min.js}" type="text/javascript"></script>
<script th:src="@{/js/nav.js}" type="text/javascript"></script>
<script th:src="@{/js/contact.js}" type="text/javascript"></script>
<script th:src="@{/semantic/dist/semantic.min.js}"></script>

<script th:src="@{/js/products.js}"></script>
<script th:src="@{/js/bootstrap-dialog.js}"></script>
<script th:src="@{/js/shoppingCart.js}"></script>

<script th:src="@{/js/simpleCart.js}"></script>
<script>

    simpleCart.bind("afterCreate", function () {
        $cart_table = $(".simpleCart_items table")
        $cart_table.addClass("table").addClass("table-hover")
    });


    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");


    simpleCart({
        checkout: {
            type: "SendForm",
            url: "/orders",
//            success: "confirm.html" ,

            extra_data: {
                _csrf: token,
                _csrf_header: header
            }
        },
        currency: "EUR",


        cartColumns: [
            {
                view: function (item, column) {
                    return "<img src='" + item.get('image') + "' height=\"60\" width=\"60\">";
                },
                attr: 'image'
            },
            {attr: "price", label: "Price", view: 'currency'},

            {attr: "quantity", label: "Qty"},

            {attr: "total", label: "SubTotal", view: 'currency'},
            {view: "remove", text: "Remove", label: false}

        ],
        cartStyle: "table"
    });

</script>

<script type="text/javascript">
    var token = $("meta[name='_csrf']").attr("content");
    var header = $("meta[name='_csrf_header']").attr("content");
    $(document).ajaxSend(function (e, xhr, options) {
        xhr.setRequestHeader(header, token);
    });
</script>

<script type="text/javascript">

    var money = null;

    function assignToGlobalVariableUserMoney(userMoney) {
        money = userMoney;
    }

    simpleCart.bind('beforeAdd', function (item) {
        var price = item.get('price');
        if (money.denomination >= price) {
            money.denomination = money.denomination - price;
            updateNavbarUserMoney(money);
        } else {
            alert('Sorry, you do not have enough money for this product');
            return false;
        }
        console.log(money);
        return true;
    });


    simpleCart.bind('beforeRemove', function (item) {
        var totalCost = item.get('total');
        money.denomination = money.denomination + totalCost;
        updateNavbarUserMoney(money);

    });

    $(document).ready(function () {
        $('.ui.modal').modal();
        $('.ui.dropdown').dropdown();


        $('#modal-product').modal('attach events', '#add-product', 'show').modal({});

        // clear shopping cart after page refresh
        sessionStorage.clear();

        userMoney(assignToGlobalVariableUserMoney);
        userMoney(updateNavbarUserMoney);


        $('body').scrollspy({
            target: '.navbar-fixed-top',
            offset: 50
        });

        $("#imgInp").change(function() {
            console.log('dzialam');
            readURL(this);
        });
    });

    function readURL(input) {

        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function(e) {
                $('#blah').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }


</script>

</body>
</html>